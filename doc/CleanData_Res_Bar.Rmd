---
title: "Clean Data (Resturants, Bars and Clubs)"
output: html_notebook
---
# Resturant
```{r}
library(openxlsx)
library(xlsx)

dat <- read.xlsx("../data/DOHMH_New_York_City_Restaurant_Inspection_Results.xlsx",1)
str(dat)
```

## Manhattan Only
```{r}
library(dplyr)

res.mah <- dat %>%
  distinct(BUILDING, STREET, ZIPCODE,.keep_all = TRUE) %>%
  filter(BORO == "MANHATTAN")
write.csv(res.mah, file = "../output/Resturant/Resturant_Mah.csv")
```

## Put in geo loc
```{r}
library(dplyr)
library(ggmap)

res.mah <- read.csv("../output/Resturant/Resturant_Mah.csv")
res.mah.short <- res.mah %>%
  select(DBA, BUILDING, STREET, ZIPCODE, CUISINE.DESCRIPTION)


# res.mah1 <- res.mah[1:2400, ]
# loc1 <- res.mah1 %>%
#   select("DBA", "BUILDING", "STREET", "ZIPCODE", "PHONE", "CUISINE.DESCRIPTION", "GRADE")%>%
#   mutate(ADDRESS = paste(BUILDING, STREET, "New York, NY", sep = ", ")) %>%
#   mutate_geocode(ADDRESS)
# write.csv(loc1, file = "../output/Resturant/resturant_location00.csv")
```

```{r}
for (i in 0:3){
  if((i+1)*2400 < nrow(res.mah.short)){
  n = i*2400+1
  data = res.mah.short[n:(n+2400-1), ]
  }
  else{
    data = res.mah.short[(i*2400+1):nrow(res.mah.short), ]
  }
  path <- paste0("../output/Resturant/resturant_location", i, ".csv")
  write.csv(data, file = path)
}
# 
# write.csv(test, file = path)
```

```{r}

```


# Bars and Clubs
```{r}
dat2 <- read.csv("../data/Liquor_Authority_Quarterly_List_of_Active_Licenses.csv", 
                 header = TRUE, na.strings = "NA", as.is = TRUE)
str(dat2)
lapply(dat2, class)
```

```{r}
count.mah <- dat2 %>%
  distinct(License.Serial.Number, .keep_all = TRUE) %>%
  group_by(County.Name..Licensee.) %>%
  summarise(value = n())

liquor.ny <- dat2 %>%
  distinct(License.Serial.Number, .keep_all = TRUE) %>%
  filter(County.Name..Licensee. == "NEW YORK")

count.type <- liquor.ny %>%
  group_by(License.Type.Name) %>%
  summarise(value = n())

bars <- liquor.ny %>%
  filter(License.Type.Name == "ON-PREMISES LIQUOR")
write.csv(bars, file = "../output/Resturant/bars.csv")

clubs <- liquor.ny %>%
  filter(License.Type.Name == "CLUB LIQUOR" | License.Type.Name == "CLUB WINE")
write.csv(clubs, file = "../output/Resturant/clubs.csv")
```
